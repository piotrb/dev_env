#!/usr/bin/env ruby

branches = []
current_branch = nil

`git branch --merged`.strip.split("\n").each do |line|
  line.strip!
  if line =~ /^\*/
    line.gsub!(/^\* /, '')
    current_branch = line
  end
  branches << line
end

raise "should be ran from master or develop" unless ["master","develop"].include?(current_branch) || ENV['FORCE']

branches -= ["develop", "master", current_branch, "releases"]

def sh(cmd)
  puts "# #{cmd}"
  r = system(cmd)
  raise "execution failed: #{$?.status}" unless r
end

if branches.empty?
  puts "nothing to clean up"
end

branches.each do |branch|
  sh "git branch -d #{branch.inspect}"
end
